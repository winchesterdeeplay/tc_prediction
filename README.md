# üåä Cyclone Trajectory Prediction

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏


1. **SimpleGRUModel** - –±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
   - GRU —Å–ª–æ–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
   - –û—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ–ª–æ–≤–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
   - Dropout –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏
   - –í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

2. **LightningCycloneModel** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å PyTorch Lightning:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ ONNX —Ñ–æ—Ä–º–∞—Ç

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **–ù–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤** (6, 24, 48) –≤–ø–µ—Ä–µ–¥ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ 
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**: –¥–∞–≤–ª–µ–Ω–∏–µ, —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –¥—Ä.
- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**: –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –≤—Ä–µ–º—è –≥–æ–¥–∞, —Ç–∏–ø —Ü–∏–∫–ª–æ–Ω–∞
- **–î–ª–∏–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π**: –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**: Œîlat, Œîlon (–≤ –≥—Ä–∞–¥—É—Å–∞—Ö)

## üéØ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–≤

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–≥–æ—Ç**:
   ```python
   # –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É [-180, 180]
   normalized_lon = (lon + 180) % 360 - 180
   ```

2. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**:
   ```python
   # –¢–∞—Ä–≥–µ—Ç—ã - —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
   dlat = target_lat - current_lat
   dlon = target_lon - current_lon
   ```


### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:

- **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π**: —Ñ–æ—Ä–º—É–ª–∞ –≥–∞–≤–µ—Ä—Å–∏–Ω—É—Å–∞ –¥–ª—è —Ç–æ—á–Ω—ã—Ö –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
- **–°–∫–æ—Ä–æ—Å—Ç–∏ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è**: –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –æ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è**: —É–≥–ª—ã –º–µ–∂–¥—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏

## üöÄ API

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /model/info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏
- `POST /predict` - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –æ–¥–∏–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç
- `POST /predict/multiple-horizons` - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```bash
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{
    "cyclone_data": [
      {
        "intl_id": "2023001",
        "storm_name": "TEST_STORM",
        "analysis_time": "2023-01-01T12:00:00",
        "lat_deg": 15.5,
        "lon_deg": 120.3,
        "central_pressure_hpa": 1000.0,
        "grade": 3
      },
      {
        "intl_id": "2023001",
        "storm_name": "TEST_STORM",
        "analysis_time": "2023-01-01T18:00:00",
        "lat_deg": 16.2,
        "lon_deg": 119.8,
        "central_pressure_hpa": 995.0,
        "grade": 4
      },
      {
        "intl_id": "2023001",
        "storm_name": "TEST_STORM",
        "analysis_time": "2023-01-02T00:00:00",
        "lat_deg": 16.8,
        "lon_deg": 119.2,
        "central_pressure_hpa": 990.0,
        "grade": 5
      }
    ],
    "horizon_hours": 24,
    "batch_size": 256
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "predictions": [
    {
      "intl_id": "2023001",
      "storm_name": "TEST_STORM",
      "analysis_time": "2023-01-02T00:00:00",
      "lat_deg": 16.8,
      "lon_deg": 119.2,
      "dlat_pred": 0.2,
      "dlon_pred": -0.7,
      "lat_pred": 17.0,
      "lon_pred": 118.5
    }
  ],
  "horizon_hours": 24,
  "total_predictions": 1,
  "processing_time_ms": 78.4
}
```

## üê≥ –ó–∞–ø—É—Å–∫ —Å Docker

```bash
docker-compose up --build
```


## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tc_prediction/
‚îú‚îÄ‚îÄ api/                    # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ service.py         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
‚îÇ   ‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
‚îú‚îÄ‚îÄ core/                   # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ coordinates.py     # –†–∞–±–æ—Ç–∞ —Å –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ features.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ constants.py       # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ models/                 # –ú–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ model.py           # –û—Å–Ω–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ losses.py          # –§—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å
‚îÇ   ‚îî‚îÄ‚îÄ dataset.py         # Dataset –∫–ª–∞—Å—Å—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ training/               # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ data_module.py     # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ data_processing/        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ data_processor.py  # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ base_processor.py  # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ inference_processor.py # –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ dataset_models.py  # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ dataset_utils.py   # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ evaluation/            # –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ evaluator.py       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –æ—Ü–µ–Ω–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ visualization.py   # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ inference/             # –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ onnx_pipeline.py   # ONNX –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îú‚îÄ‚îÄ bst_data/              # –î–∞–Ω–Ω—ã–µ BST (Best Track)
‚îÇ   ‚îú‚îÄ‚îÄ bst_all.txt        # –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ BST
‚îÇ   ‚îú‚îÄ‚îÄ bst_all.csv        # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ CSV
‚îÇ   ‚îú‚îÄ‚îÄ parse_bst.py       # –ü–∞—Ä—Å–µ—Ä BST –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ processed_dataset.pkl # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ bst_all_description.md # –û–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ weights/               # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ train.ipynb           # Jupyter notebook –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ run_api.py            # –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .dockerignore         # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
‚îú‚îÄ‚îÄ pyproject.toml        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ uv.lock              # Lock —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ mypy.ini             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MyPy
‚îú‚îÄ‚îÄ .python-version      # –í–µ—Ä—Å–∏—è Python
‚îî‚îÄ‚îÄ .gitignore           # –ò—Å–∫–ª—é—á–µ–Ω–∏—è Git
```